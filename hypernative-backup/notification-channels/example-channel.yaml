# Example Hypernative Notification Channels Configuration
# This file demonstrates different types of notification channels

# Production Webhook Channel
---
name: "Production Webhook"
description: "Primary webhook endpoint for production alerts"
type: "webhook"
enabled: true

# Tags for organization and filtering
tags:
  environment: "production"
  team: "security"
  priority: "high"
  channel_type: "webhook"

# Webhook-specific configuration
configuration:
  # Webhook endpoint URL
  url: "https://api.company.com/hypernative-alerts"
  
  # HTTP method (POST is default for webhooks)
  method: "POST"
  
  # Custom headers
  headers:
    Authorization: "Bearer ${WEBHOOK_TOKEN}"
    Content-Type: "application/json"
    X-API-Version: "v2"
    X-Source: "hypernative"
  
  # Webhook signing secret for verification
  secret: "${WEBHOOK_SIGNING_SECRET}"
  
  # Request timeout (in seconds)
  timeout: 30
  
  # Retry configuration
  retry_config:
    max_retries: 3
    retry_delay: 5  # seconds
    exponential_backoff: true
    max_delay: 60  # seconds
  
  # Custom payload template
  payload_template:
    alert_id: "{{alert_id}}"
    timestamp: "{{timestamp}}"
    severity: "{{severity}}"
    source: "hypernative"
    event_type: "security_alert"
    data:
      title: "{{title}}"
      description: "{{description}}"
      resource_type: "{{resource_type}}"
      resource_id: "{{resource_id}}"
      chain: "{{chain}}"
      risk_score: "{{risk_score}}"
      affected_addresses: "{{affected_addresses}}"
      transaction_hash: "{{transaction_hash}}"
      block_number: "{{block_number}}"
      additional_context: "{{context}}"

# Testing and validation
testing:
  # Enable test mode (sends test payloads)
  test_mode: false
  
  # Test endpoint for validation
  test_endpoint: "https://webhook.site/test-endpoint"

---
# Slack Notification Channel
name: "Slack Security Alerts"
description: "Slack channel for security team notifications"
type: "slack"
enabled: true

tags:
  environment: "production"
  team: "security"
  platform: "slack"

configuration:
  # Slack webhook URL
  webhook_url: "${SLACK_WEBHOOK_URL}"
  
  # Target channel (optional, can be in webhook URL)
  channel: "#security-alerts"
  
  # Bot username and icon
  username: "Hypernative"
  icon_emoji: ":warning:"
  
  # Message formatting
  message_template:
    text: ":rotating_light: Security Alert from Hypernative"
    attachments:
      - color: "{{severity_color}}"
        title: "{{title}}"
        text: "{{description}}"
        fields:
          - title: "Severity"
            value: "{{severity}}"
            short: true
          - title: "Chain"
            value: "{{chain}}"
            short: true
          - title: "Risk Score"
            value: "{{risk_score}}/100"
            short: true
          - title: "Resource"
            value: "{{resource_type}}: {{resource_id}}"
            short: false
          - title: "Transaction"
            value: "<https://etherscan.io/tx/{{transaction_hash}}|View on Etherscan>"
            short: false
        footer: "Hypernative Security Monitoring"
        ts: "{{timestamp_unix}}"
  
  # Mention configuration
  mentions:
    # Mention specific users for critical alerts
    critical_severity: ["@channel", "@security-lead"]
    high_severity: ["@security-team"]
    medium_severity: []
  
  # Thread configuration
  threading:
    # Group related alerts in threads
    group_by: "resource_id"
    thread_timeout: "1h"  # New thread after 1 hour

---
# Email Notification Channel
name: "Email Security Team"
description: "Email notifications for security team members"
type: "email"
enabled: true

tags:
  environment: "production"
  team: "security"
  platform: "email"

configuration:
  # SMTP configuration
  smtp:
    host: "smtp.company.com"
    port: 587
    secure: true
    auth:
      user: "${SMTP_USERNAME}"
      pass: "${SMTP_PASSWORD}"
  
  # Email addresses
  recipients:
    to:
      - "security-team@company.com"
      - "devops@company.com"
    cc:
      - "security-lead@company.com"
    bcc: []
  
  # Email template
  template:
    subject: "[HYPERNATIVE] {{severity_upper}}: {{title}}"
    html_body: |
      <!DOCTYPE html>
      <html>
      <head>
          <style>
              body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
              .header { background: #dc3545; color: white; padding: 20px; text-align: center; }
              .content { padding: 20px; }
              .alert-info { background: #f8f9fa; padding: 15px; border-left: 4px solid #dc3545; margin: 20px 0; }
              .footer { background: #6c757d; color: white; padding: 10px; text-align: center; font-size: 12px; }
              .button { display: inline-block; padding: 10px 20px; background: #007bff; color: white; text-decoration: none; border-radius: 4px; }
          </style>
      </head>
      <body>
          <div class="header">
              <h1>ðŸš¨ Hypernative Security Alert</h1>
          </div>
          <div class="content">
              <h2>{{title}}</h2>
              <p>{{description}}</p>
              
              <div class="alert-info">
                  <h3>Alert Details</h3>
                  <ul>
                      <li><strong>Severity:</strong> {{severity}}</li>
                      <li><strong>Chain:</strong> {{chain}}</li>
                      <li><strong>Risk Score:</strong> {{risk_score}}/100</li>
                      <li><strong>Resource:</strong> {{resource_type}} ({{resource_id}})</li>
                      <li><strong>Time:</strong> {{timestamp}}</li>
                      {{#if transaction_hash}}
                      <li><strong>Transaction:</strong> <a href="https://etherscan.io/tx/{{transaction_hash}}">{{transaction_hash}}</a></li>
                      {{/if}}
                  </ul>
              </div>
              
              {{#if affected_addresses}}
              <h3>Affected Addresses</h3>
              <ul>
                  {{#each affected_addresses}}
                  <li><code>{{this}}</code></li>
                  {{/each}}
              </ul>
              {{/if}}
              
              <p>
                  <a href="https://app.hypernative.xyz/alerts/{{alert_id}}" class="button">
                      View in Hypernative Dashboard
                  </a>
              </p>
          </div>
          <div class="footer">
              Generated by Hypernative Security Monitoring Platform
          </div>
      </body>
      </html>
    
    text_body: |
      HYPERNATIVE SECURITY ALERT
      
      {{title}}
      {{description}}
      
      Alert Details:
      - Severity: {{severity}}
      - Chain: {{chain}}
      - Risk Score: {{risk_score}}/100
      - Resource: {{resource_type}} ({{resource_id}})
      - Time: {{timestamp}}
      {{#if transaction_hash}}
      - Transaction: {{transaction_hash}}
      {{/if}}
      
      {{#if affected_addresses}}
      Affected Addresses:
      {{#each affected_addresses}}
      - {{this}}
      {{/each}}
      {{/if}}
      
      View details: https://app.hypernative.xyz/alerts/{{alert_id}}

---
# Discord Notification Channel
name: "Discord Alerts"
description: "Discord webhook for community alerts"
type: "discord"
enabled: false  # Disabled by default

tags:
  environment: "staging"
  team: "community"
  platform: "discord"

configuration:
  webhook_url: "${DISCORD_WEBHOOK_URL}"
  
  # Discord embed configuration
  embed:
    title: "ðŸ”” {{title}}"
    description: "{{description}}"
    color: "{{severity_color_hex}}"  # Hex color code based on severity
    footer:
      text: "Hypernative Security Monitoring"
      icon_url: "https://hypernative.xyz/logo.png"
    thumbnail:
      url: "https://hypernative.xyz/alert-icon.png"
    fields:
      - name: "Severity"
        value: "{{severity}}"
        inline: true
      - name: "Chain" 
        value: "{{chain}}"
        inline: true
      - name: "Risk Score"
        value: "{{risk_score}}/100"
        inline: true
      - name: "Resource"
        value: "{{resource_type}}: `{{resource_id}}`"
        inline: false
    timestamp: "{{timestamp_iso}}"
  
  # Mention roles for different severities
  mentions:
    critical: ["@Security Team", "@everyone"]
    high: ["@Security Team"]
    medium: []
    low: []

---
# PagerDuty Integration
name: "PagerDuty Critical"
description: "PagerDuty integration for critical alerts only"
type: "pagerduty"
enabled: true

tags:
  environment: "production"
  team: "oncall"
  severity: "critical"
  platform: "pagerduty"

configuration:
  # PagerDuty Events API key
  integration_key: "${PAGERDUTY_INTEGRATION_KEY}"
  
  # Severity filter (only send these severities)
  severity_filter: ["critical", "high"]
  
  # Event configuration
  event_action: "trigger"  # Options: trigger, acknowledge, resolve
  
  # Custom fields for PagerDuty
  custom_details:
    alert_id: "{{alert_id}}"
    chain: "{{chain}}"
    resource_type: "{{resource_type}}"
    resource_id: "{{resource_id}}"
    risk_score: "{{risk_score}}"
    transaction_hash: "{{transaction_hash}}"
    affected_addresses: "{{affected_addresses}}"
    hypernative_dashboard_url: "https://app.hypernative.xyz/alerts/{{alert_id}}"
  
  # Deduplication key to prevent duplicate incidents
  dedup_key: "{{resource_type}}-{{resource_id}}-{{alert_type}}"

---
# Microsoft Teams Channel
name: "Teams Operations"
description: "Microsoft Teams webhook for operations team"
type: "msteams"
enabled: true

tags:
  environment: "production" 
  team: "operations"
  platform: "msteams"

configuration:
  webhook_url: "${MSTEAMS_WEBHOOK_URL}"
  
  # Teams message card format
  card_template:
    "@type": "MessageCard"
    "@context": "https://schema.org/extensions"
    summary: "Hypernative Alert: {{title}}"
    themeColor: "{{severity_color_hex}}"
    sections:
      - activityTitle: "ðŸš¨ Hypernative Security Alert"
        activitySubtitle: "{{title}}"
        activityImage: "https://hypernative.xyz/alert-icon.png"
        text: "{{description}}"
        facts:
          - name: "Severity"
            value: "{{severity}}"
          - name: "Chain"
            value: "{{chain}}"
          - name: "Risk Score"
            value: "{{risk_score}}/100"
          - name: "Resource"
            value: "{{resource_type}}: {{resource_id}}"
          - name: "Time"
            value: "{{timestamp}}"
    potentialAction:
      - "@type": "OpenUri"
        name: "View in Dashboard"
        targets:
          - os: "default"
            uri: "https://app.hypernative.xyz/alerts/{{alert_id}}"